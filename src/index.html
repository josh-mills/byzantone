<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ByzanTone</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Gentium+Plus:ital,wght@0,400;0,700;1,400;1,700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=IM+Fell+Double+Pica:ital@0;1&family=Lora:ital@0;1&display=swap"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/gh/danielgarthur/byzhtml@1.0.16/dist/Neanes.css"
        />
        <script src="https://cdn.jsdelivr.net/gh/danielgarthur/byzhtml@1.0.16/dist/byzhtml.min.js"></script>
        <link rel="stylesheet" type="text/css" href="dist/main.css" />
    </head>
    <body>
        <script src="dist/elm.js"></script>
        <div id="elm-app"></div>
        <script>
            function getDeviceInfo() {
                const userAgent =
                    navigator.userAgent || navigator.vendor || window.opera;

                const isMobileDevice =
                    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                        userAgent,
                    );

                const hasTouchScreen =
                    "maxTouchPoints" in navigator &&
                    navigator.maxTouchPoints > 0;

                return {
                    userAgent,
                    isMobileDevice,
                    hasTouchScreen,
                };
            }

            function getViewportInfo() {
                return {
                    width: window.innerWidth,
                    height: window.innerHeight,
                };
            }

            const elm = Elm.Main.init({
                node: document.getElementById("elm-app"),
                flags: {
                    deviceInfo: getDeviceInfo(),
                    viewport: getViewportInfo(),
                },
            });

            document.addEventListener("pitchDetected", (event) => {
                if (elm.ports && elm.ports.pitchDetected) {
                    elm.ports.pitchDetected.send({
                        pitch: event.detail.pitch,
                    });
                }
            });
        </script>

        <script src="dist/src/chant_engine.js"></script>
        <script src="dist/src/pitch_tracker.js"></script>
    </body>
</html>
